<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins 安装及自动部署 | Java 开发知识体系</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="xxxx">
    
    <link rel="preload" href="/assets/css/0.styles.f111fb23.css" as="style"><link rel="preload" href="/assets/js/app.0231cced.js" as="script"><link rel="preload" href="/assets/js/2.972344c2.js" as="script"><link rel="preload" href="/assets/js/13.771d4a93.js" as="script"><link rel="prefetch" href="/assets/js/10.3837ac29.js"><link rel="prefetch" href="/assets/js/11.18aa115b.js"><link rel="prefetch" href="/assets/js/12.cce639b3.js"><link rel="prefetch" href="/assets/js/14.b7a7b293.js"><link rel="prefetch" href="/assets/js/15.dc69d892.js"><link rel="prefetch" href="/assets/js/16.a965be8e.js"><link rel="prefetch" href="/assets/js/17.5d2d380f.js"><link rel="prefetch" href="/assets/js/18.05df3d31.js"><link rel="prefetch" href="/assets/js/19.58306047.js"><link rel="prefetch" href="/assets/js/20.3f850222.js"><link rel="prefetch" href="/assets/js/21.b179c6c0.js"><link rel="prefetch" href="/assets/js/22.0e3ebac6.js"><link rel="prefetch" href="/assets/js/23.1898e8f1.js"><link rel="prefetch" href="/assets/js/3.dc578df3.js"><link rel="prefetch" href="/assets/js/4.9126ee63.js"><link rel="prefetch" href="/assets/js/5.dbceb499.js"><link rel="prefetch" href="/assets/js/6.084197a9.js"><link rel="prefetch" href="/assets/js/7.305b84ee.js"><link rel="prefetch" href="/assets/js/8.a5d627b3.js"><link rel="prefetch" href="/assets/js/9.259ccf49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f111fb23.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Java 开发知识体系</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          消息中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/kafka/Kafka系列一消息队列.html" class="nav-link">
  Kafka 系列
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具｜部署" class="dropdown-title"><span class="title">工具｜部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具｜部署" class="mobile-dropdown-title"><span class="title">工具｜部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          IntelliJ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/devops/intellij/recommoned/禁用非必需插件，让 IDE 飞起.html" class="nav-link">
  实用插件推荐
</a></li><li class="dropdown-subitem"><a href="/md/devops/intellij/plugin/Simple Deployment.html" class="nav-link">
  插件开发
</a></li></ul></li><li class="dropdown-item"><h4>
          CI &amp; CD
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/devops/tool/Jenkins安装及自动部署.html" class="nav-link">
  Jenkins
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          消息中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/kafka/Kafka系列一消息队列.html" class="nav-link">
  Kafka 系列
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具｜部署" class="dropdown-title"><span class="title">工具｜部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具｜部署" class="mobile-dropdown-title"><span class="title">工具｜部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          IntelliJ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/devops/intellij/recommoned/禁用非必需插件，让 IDE 飞起.html" class="nav-link">
  实用插件推荐
</a></li><li class="dropdown-subitem"><a href="/md/devops/intellij/plugin/Simple Deployment.html" class="nav-link">
  插件开发
</a></li></ul></li><li class="dropdown-item"><h4>
          CI &amp; CD
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/devops/tool/Jenkins安装及自动部署.html" class="nav-link">
  Jenkins
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>IDEA 插件推荐</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/devops/intellij/recommoned/禁用非必需插件，让 IDE 飞起.html" class="sidebar-link">实用插件推荐 - 禁用插件，让 IDE 飞起</a></li><li><a href="/md/devops/intellij/recommoned/实用插件推荐 CodeGlance Pro.html" class="sidebar-link">实用插件推荐 - Code Glance Pro</a></li><li><a href="/md/devops/intellij/recommoned/实用插件推荐 show comment.html" class="sidebar-link">实用插件推荐 - Show Comment</a></li><li><a href="/md/devops/intellij/recommoned/实用插件推荐 Key Promoter X.html" class="sidebar-link">实用插件推荐 - Key Promoter X</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>IDEA 插件开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/devops/intellij/plugin/Simple Deployment.html" class="sidebar-link">Simple Deployment</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CI &amp; CD</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/devops/tool/Jenkins安装及自动部署.html" class="active sidebar-link">Jenkins 安装及自动部署</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安装以及启停管理"><a href="#安装以及启停管理" class="header-anchor">#</a> 安装以及启停管理</h1> <h2 id="jenkins-war包下载"><a href="#jenkins-war包下载" class="header-anchor">#</a> Jenkins War包下载</h2> <p>到<a href="http://mirrors.jenkins-ci.org/" target="_blank" rel="noopener noreferrer">官方镜像网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载选择适合自己系统的 war 包。Jenkins 项目产生两个发行线, 长期支持版本 (LTS) 和每周更新版本，这里选择的是最新的 <a href="http://mirrors.jenkins-ci.org/war-stable/2.289.1/" target="_blank" rel="noopener noreferrer">2.289.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 LTS 版本。Jenkins 以 WAR 文件、原生包/安装程序和 Docker 镜像分发，这里仅使用 war 包进行安装。</p> <h2 id="tomcat-8-5-下载"><a href="#tomcat-8-5-下载" class="header-anchor">#</a> Tomcat 8.5 下载</h2> <p>这里选择的是 <a href="https://mirror-hk.koddos.net/apache/tomcat/tomcat-8/v8.5.68/bin/apache-tomcat-8.5.68.tar.gz" target="_blank" rel="noopener noreferrer">8.5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 版本的 tomcat。下载后解压到 <code>/usr/local/</code> 下，文件夹改名为 <code>tomcat-8.5</code> 。将下载好的 war 包，放到 <code>/usr/local/tomcat-8.5/webapps/</code> 目录下。启动 tomcat 后访问 <code>ip:8080/jenkins</code> 端口就可以看到 <code>Jenkins</code> 的页面。</p> <h2 id="jenins-安装"><a href="#jenins-安装" class="header-anchor">#</a> Jenins 安装</h2> <h3 id="_1-选择-jenins-的安装目录"><a href="#_1-选择-jenins-的安装目录" class="header-anchor">#</a> 1. 选择 Jenins 的安装目录</h3> <p><code>Jenkins</code> 默认的安装目录在 <code>/root/.jenkins</code> 下，如果不想安装在这里，可以通过修改环境变量 <code>JENKINS_HOME</code> 来修改。在 <code>/etc/profile</code> 文件中追加以下三行内容，然后执行 <code>source /etc/profile</code> 。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">JENKINS_HOME</span><span class="token operator">=</span>/data/jenkins
<span class="token builtin class-name">export</span> JENKINS_HOME
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JENKINS_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>添加后，启动 <code>Tomcat</code> 服务 <code>sh /usr/loca/tomca-8.5/bin/startup.sh</code> 。访问 <code>ip:8080/jenkins</code> ，看到如下界面就算正常，接下来只需要到到文件 <code>/data/jenkins/secrets/initialAdminPassword</code> 找到密码即可。<code>/data/jenkins</code> 是上面设置的 <code>JENKINS_HOME</code> 可以看到配置是生效的。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/jenkins%E5%88%9D%E5%A7%8B%E7%95%8C%E9%9D%A2.png" alt="jenkins初始界面"></p> <h3 id="_2-安装插件和新建用户"><a href="#_2-安装插件和新建用户" class="header-anchor">#</a> 2. 安装插件和新建用户</h3> <p>输入密码后，如果网络正常，那么大概率可以正常安装插件。如果不能安装插件，那么就先跳过安装插件，等下再来处理。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins%E7%A6%BB%E7%BA%BF.png" alt="Jenkins离线"></p> <p>跳过安装插件后，会来到用户创建界面，可以先建一个用户，输入账号密码即可。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7.jpg" alt="Jenkins-第一个用户"></p> <p>用户创建后会自动登录，接下来就是安装插件。</p> <p>可能由于有些网站是国外的，默认的插件安装中心特别慢。或者由于证书问题，根本无法访问插件安装中心。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-SSLException.jpg" alt="Jenkins-SSLException"></p> <p>这里提供一个解决办法以及相关文件。</p> <h4 id="修改插件安装中心"><a href="#修改插件安装中心" class="header-anchor">#</a> 修改插件安装中心</h4> <ol><li><p>找到 <code>$JENKINS_HOME/hudson.model.UpdateCenter.xml</code> 文件，将其中的 url 标签该为 <code>http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p> <p>修改后的内容为。然后重启 <code>Tomcat</code> 服务。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version='1.1' encoding='UTF-8'?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sites</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>site</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sites</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重启之后，会发现可以正常搜索插件了。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/jenkins-%E6%8F%92%E4%BB%B6%E4%B8%AD%E5%BF%83-1.jpg" alt="jenkins-插件中心-1"></p> <p>但是安装插件会报错，报的是找不到证书的异常，那是因为 Java 发送 HTTPS 请求时，没有证书导致的，所以只需要将 HTTPS 改为 HTTP 就行了。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-SSLException-1.jpg" alt="Jenkins-SSLException-1"></p> <p>具体是修改 <code>/data/jenkins/updates/default.json</code> 文件中的内容，将所有 <code>https://mirrors.tuna.tsinghua.edu.cn</code> 修改为 <code>http://mirrors.tuna.tsinghua.edu.cn</code>。另外还有一个，将 <code>connectionCheckUrl</code> 由 <code>http://www.google.com/</code> 修改为 <code>http://www.baidu.com</code>。</p> <p>这里提供一个修改过的文件，可以直接下载使用。</p> <p><a href="https://www.lin2j.tech/blog-image/jenkins/default.json" target="_blank" rel="noopener noreferrer">default.json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>替换之后，重启 <code>Tomcat</code> 服务，然后重新试着安装，就可以了。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/jenkins-%E6%8F%92%E4%BB%B6%E4%B8%AD%E5%BF%83-2.png" alt="jenkins-插件中心-2"></p> <p>到这里就算安装完成了，接下来根据需要安装插件即可。</p></li></ol> <h3 id="_3-修改-jenins-的占用端口"><a href="#_3-修改-jenins-的占用端口" class="header-anchor">#</a> 3. 修改 Jenins 的占用端口</h3> <p>这里使用的是 <code>Tomcat</code> ，默认占用的端口 8080。如果不想使用这个端口，可以通过修改 <code>Tomcat</code> 的配置文件 <code>/usr/local/tomcat-8.5/conf/server.xml</code> 改变端口。找到</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改为 9696，或者其他你想要的端口。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>9696<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>重启 <code>Tomcat</code>，再访问 <code>ip:9696</code> 端口，正常访问就算正常。</p> <h3 id="_4-jenkins-system-service"><a href="#_4-jenkins-system-service" class="header-anchor">#</a> 4. Jenkins System Service</h3> <p>新建一个文件 <code>/lib/systemd/system/jenkins.service</code> ，然后添加以下内容</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>jenkins
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/tomcat-8.5/bin/startup.sh
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/tomcat-8.5/bin/shutdown.sh
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>执行命令 <code>systemctl daemon-reload</code> 使文件生效。</p> <p>执行 <code>systemctl enable jenkins</code> 启动开机自动启动 <code>Jenkins</code> 服务。</p> <p>接下来就可以使用 <code>systemctl start jenkins</code> 启动 <code>Jenkins</code> 服务，使用 <code>systemctl stop jenkins</code> 停止 <code>Jenkins</code> 服务。</p> <h1 id="jenkins-自动部署-基于gitlab"><a href="#jenkins-自动部署-基于gitlab" class="header-anchor">#</a> Jenkins 自动部署（基于Gitlab）</h1> <h2 id="前置条件"><a href="#前置条件" class="header-anchor">#</a> 前置条件</h2> <h3 id="相关插件"><a href="#相关插件" class="header-anchor">#</a> 相关插件</h3> <ol><li><p><a href="https://plugins.jenkins.io/maven-plugin" target="_blank" rel="noopener noreferrer">Maven Integration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：在部署spring boot 项目的时候, 我们需要创建maven项目, 在安装了这个插件之后, 在创建项目的时候, 如果没有这个插件, 在创建项目的时候就没有 <code>构建一个maven项目</code>的选项。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-plugin-maven.jpg" alt="Jenkins-plugin-maven"></p></li> <li><p><a href="https://plugins.jenkins.io/git-parameter" target="_blank" rel="noopener noreferrer">Git Parameter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ： 在后续的自动化部署中, 我们需要通过参数, 设置不同的分支, 对不同的分支进行打包, 需要这个插件的支持。</p></li> <li><p><a href="https://plugins.jenkins.io/gitlab-hook" target="_blank" rel="noopener noreferrer">Gitlab Hook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：gitlab webhook 回调插件，设置好jenkins的回调url后就可以让jenkins进行自动构建。</p></li> <li><p><a href="https://plugins.jenkins.io/gitlab-plugin" target="_blank" rel="noopener noreferrer">GitLab Plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：远程构建的步骤里需要它，安装了之后，才会有红框里的那一个选项。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-Gitlab-Plugin.png" alt="Jenkins-Gitlab-Plugin"></p></li></ol> <h3 id="支持环境"><a href="#支持环境" class="header-anchor">#</a> 支持环境</h3> <ol><li>JDK 1.8 ：在服务器构建 SpringBoot 项目的时候，需要用到 jdk 的一些工具。</li> <li>Maven：在服务器构建项目的时候，需要使用 mvn 命令下载相关依赖。</li> <li>Git：需要通过 git clone 来下载项目的代码文件。</li></ol> <p>需要在 <code>Manage Jenkins</code> --&gt; <code>Global Tool Configuration</code> 里面配置相关工具的位置。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E7%8E%AF%E5%A2%83%E6%94%AF%E6%8C%81.jpg" alt="Jenkins-环境支持"></p> <h3 id="添加-gitlab-凭据"><a href="#添加-gitlab-凭据" class="header-anchor">#</a> 添加 Gitlab 凭据</h3> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E6%B7%BB%E5%8A%A0%E5%87%AD%E6%8D%AE.jpg" alt="Jenkins-添加凭据"></p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/jenkins-%E6%B7%BB%E5%8A%A0%E5%87%AD%E6%8D%AE0.png" alt="jenkins-添加凭据0"></p> <h2 id="gitlab-示例"><a href="#gitlab-示例" class="header-anchor">#</a> Gitlab 示例</h2> <h3 id="项目结构"><a href="#项目结构" class="header-anchor">#</a> 项目结构</h3> <p>新建一个 <a href="https://github.com/lin2j/jenkins-demo" target="_blank" rel="noopener noreferrer">jenkins-demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 SpringBoot 项目，然后上传到 Gitlab 上做版本控制（github 也上传了，需要可以自取）。这个项目使用 <code>maven-assembly-plugin</code> 来打包，<code>bin/run.sh</code> 目录下有一个启停脚本 <code>run.sh</code> 可以方便控制程序。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-github-demo.jpg" alt="Jenkins-github-demo"></p> <h3 id="新建任务"><a href="#新建任务" class="header-anchor">#</a> 新建任务</h3> <p>新建一个 maven 项目</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1.jpg" alt="Jenkins-新建任务"></p> <h3 id="源码管理"><a href="#源码管理" class="header-anchor">#</a> 源码管理</h3> <p>填写远程仓库信息</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1-%E6%BA%90%E7%A0%81%E7%AE%A1%E7%90%86.png" alt="Jenkins-新建任务-源码管理"></p> <h3 id="构建触发器"><a href="#构建触发器" class="header-anchor">#</a> 构建触发器</h3> <p>这个 url 是给gitlab 的 webhook 准备的，webhook 通过这个 url 进行回调。如果直接使用这个 url 报了 403 的错误，那么可以将url 改为这个样子</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://USERNAME:PASSWORD@172.25.20.69:8080/jenkins/project/jenkins-demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中<code>USERNAME</code> 是Jenkins 的登录账号，<code>PASSWORD</code> 是密码。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E6%9E%84%E5%BB%BA%E4%BB%BB%E5%8A%A1-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8.png" alt="Jenkins-构建任务-构建触发器"></p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1-%E6%BA%90%E7%A0%81%E7%AE%A1%E7%90%86-2.png" alt="Jenkins-新建任务-源码管理-2"></p> <h3 id="在gitlab中添加-webhook"><a href="#在gitlab中添加-webhook" class="header-anchor">#</a> 在Gitlab中添加 Webhook</h3> <p>将构建触发器阶段生成的 url 和 token 填写到 gitlab 中，然后进行测试，返回200则算成功。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-gitlab-webhook.png" alt="Jenkins-gitlab-webhook"></p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-gitlab-webhook-test.png" alt="Jenkins-gitlab-webhook-test"></p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-gitlab-webhook-test-200.png" alt="Jenkins-gitlab-webhook-test-200"></p> <h3 id="配置-post-build"><a href="#配置-post-build" class="header-anchor">#</a> 配置 Post-build</h3> <p>在 <code>Add post-build step</code> 中选择 <code>Exceute shell</code> 选项，然后添加 shell 脚本。这里提供一下我的脚本。基本上对于我的项目结构，只需要修改 <code>MODULE</code> 和 <code>DEPLOY_DIR</code> 变量即可。</p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-Post-build.png" alt="Jenkins-Post-build"></p> <p><img src="https://www.lin2j.tech/blog-image/jenkins/Jenkins-Post-build-1.png" alt="Jenkins-Post-build-1"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 模块的名字</span>
<span class="token assign-left variable">MODULE</span><span class="token operator">=</span>jenkins-demo
<span class="token comment"># 部署的目录</span>
<span class="token assign-left variable">DEPLOY_DIR</span><span class="token operator">=</span>/opt
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span>  <span class="token variable">$DEPLOY_DIR</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
   <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$DEPLOY_DIR</span>
   <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> <span class="token variable">$WORKSPACE</span>/target/<span class="token variable">$MODULE</span>.tar.gz <span class="token parameter variable">-C</span> <span class="token variable">$DEPLOY_DIR</span>
<span class="token keyword">else</span>
   <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$DEPLOY_DIR</span>/<span class="token variable">$MODULE</span>*.jar
   <span class="token function">cp</span> <span class="token variable">$WORKSPACE</span>/target/<span class="token variable">$MODULE</span>*.jar <span class="token variable">$DEPLOY_DIR</span>/<span class="token variable">$MODULE</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span>  /lib/systemd/system/<span class="token variable">$MODULE</span>.service <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">sFile</span><span class="token operator">=</span>/lib/systemd/system/<span class="token variable">$MODULE</span>.service
	<span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;[Unit]&quot;</span>
	<span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>Description=<span class="token variable">$MODULE</span>&quot;</span>
	<span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>After=network.target&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span> &quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>[Service]&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>Type=forking&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>ExecStart=<span class="token variable">$DEPLOY_DIR</span>/<span class="token variable">$MODULE</span>/bin/run.sh start&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>ExecReload= &quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>ExecStop=<span class="token variable">$DEPLOY_DIR</span>/<span class="token variable">$MODULE</span>/bin/run.sh stop&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>PrivateTmp=true&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span> &quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>[Install]&quot;</span>
    <span class="token assign-left variable">sContent</span><span class="token operator">=</span><span class="token variable">$sContent</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>WantedBy=multi-user.target&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$sContent</span> <span class="token operator">&gt;</span> <span class="token variable">$sFile</span>

	systemctl daemon-reload
	systemctl <span class="token builtin class-name">enable</span> <span class="token variable">$MODULE</span>
<span class="token keyword">fi</span>

systemctl restart <span class="token variable">$MODULE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h1 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h1> <p>以上就是 Jenkins 的安装部署以及自动化部署的思路，希望能够给你提供帮助。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/devops/intellij/plugin/Simple Deployment.html" class="prev">
        Simple Deployment
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0231cced.js" defer></script><script src="/assets/js/2.972344c2.js" defer></script><script src="/assets/js/13.771d4a93.js" defer></script>
  </body>
</html>
